<!-- Post sharing snippet -->

<div class="share-wrapper d-flex align-items-center">
  <span class="share-label text-muted">{{ site.data.locales[include.lang].post.share }}</span>
  <span class="share-icons">
    {% capture title %}{{ page.title }} - {{ site.title }}{% endcapture %}
    {% assign title = title | uri_escape %}
    {% assign url = page.url | absolute_url | url_encode %}

    {% for share in site.data.share.platforms -%}
    {%- capture tooltip -%}
    data-bs-toggle="tooltip" data-bs-placement="top" title="{{ share.type }}" aria-label="{{ share.type }}"
    {%- endcapture -%}

    {% if share.type == 'Mastodon' %}
    <script defer type="module" src="https://cdn.jsdelivr.net/npm/@justinribeiro/share-to-mastodon/+esm"></script>
    <button class="btn text-start" {{ tooltip }}>
      <share-to-mastodon class="share-mastodon" message="{{ title }}" url="{{ url }}" {%- if share.instances -%}
        customInstanceList="{{ share.instances | jsonify | xml_escape }}" {%- endif %}>
        <i class="fa-fw {{ share.icon }}"></i>
      </share-to-mastodon>
    </button>

    {% continue %}
    {% endif %}

    {% assign link = share.link | replace: 'TITLE', title | replace: 'URL', url %}

    <a href="{{ link }}" target="_blank" rel="noopener" {{ tooltip }}>
      <i class="fa-fw {{ share.icon }}"></i>
    </a>
    {% endfor %}

    <!-- Clipboard Copy Button -->
    <button id="copy-link-btn" class="btn btn-link p-0 ms-1" data-bs-toggle="tooltip" data-bs-placement="top"
      title="Copiar link" aria-label="Copiar link para área de transferência" onclick="copyPostLink()">
      <i class="fa-fw fas fa-link"></i>
    </button>
  </span>
</div>

<script>
  function copyPostLink() {
    const url = '{{ page.url | absolute_url }}';
    navigator.clipboard.writeText(url).then(function () {
      const btn = document.getElementById('copy-link-btn');
      const icon = btn.querySelector('i');
      const originalClass = icon.className;

      // Change icon to checkmark temporarily
      icon.className = 'fa-fw fas fa-check text-success';

      // Update tooltip
      const tooltip = bootstrap.Tooltip.getInstance(btn);
      if (tooltip) {
        btn.setAttribute('data-bs-original-title', 'Link copiado!');
        tooltip.show();
      }

      // Revert after 2 seconds
      setTimeout(function () {
        icon.className = originalClass;
        btn.setAttribute('data-bs-original-title', 'Copiar link');
        if (tooltip) {
          tooltip.hide();
        }
      }, 2000);
    });
  }
</script>